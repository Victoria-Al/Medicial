<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title></title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../css/common.css" />

    <script type="text/javascript" src="../script/api.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="../script/zepto.min.js"></script>
    <style>
        /*按钮样式*/
        button, .aui-btn {
        	position: relative;
        	display: inline-block;
        	font-size: 1rem;
        	font-weight: 400;
        	font-family: inherit;
        	text-decoration: none;
        	text-align: center;
        	margin: 0;
        	background: #dddddd;
        	padding: 0 0.6rem;
        	height: 1.5rem;
        	line-height: 1.5rem;
        	border-radius: 0.2rem;
        	white-space: nowrap;
        	text-overflow: ellipsis;
        	vertical-align: middle;
        	-webkit-box-sizing: border-box;
        			box-sizing: border-box;
        	-webkit-user-select: none;
        	      	user-select: none;
        }
        .aui-btn:active {
        	color: #212121;
        	background-color: #bdbdbd;
        }
        .aui-btn-primary {
        	color: #ffffff;
        	background-color: #00bcd4;
        }
        .aui-btn-primary.aui-active, .aui-btn-primary:active {
        	color: #ffffff;
        	background-color: #00acc1;
        }
        .aui-btn-success {
        	color: #ffffff;
        	background-color: #009688;
        }
        .aui-btn-success.aui-active, .aui-btn-success:active {
        	color: #fff;
        	background-color: #00897b;
        }
        .aui-btn-info {
        	color: #ffffff !important;
        	background-color: #03a9f4 !important;
        }
        .aui-btn-info.aui-active, .aui-btn-info:active {
        	color: #fff !important;
        	background-color: #039be5 !important;
        }
        .aui-btn-warning {
        	color: #ffffff !important;
        	background-color: #ffc107 !important;
        }
        .aui-btn-warning.aui-active, .aui-btn-warning:active {
        	color: #ffffff !important;
        	background-color: #ffb300 !important;
        }
        .aui-btn-danger {
        	color: #ffffff !important;
        	background-color: #e51c23 !important;
        }
        .aui-btn-danger.aui-active, .aui-btn-danger:active {
        	color: #ffffff !important;
        	background-color: #dd191b !important;
        }
        .aui-btn-block {
        	display: block;
        	width: 100%;
        	height: 2.5rem;
        	line-height: 2.55rem;
        	margin-bottom: 0;
        	font-size: 0.9rem;
        }
        .aui-btn-block.aui-btn-sm {
        	font-size: 0.7rem;
        	height: 1.8rem;
        	line-height: 1.85rem;
        }
        .aui-btn .aui-iconfont, .aui-btn-block .aui-iconfont {
        	margin-right: 0.3rem;
        }
        .aui-btn .aui-badge, .aui-btn-block .aui-badge {
        	margin-left: 0.3rem;
        }
        .aui-btn-outlined {
        	background: transparent !important;
        	border: 1px solid #bdbdbd;
        }
        .aui-btn-outlined:active {
        	background: transparent !important;
        }
        .aui-btn-default.aui-btn-outlined {
        	color: #bdc3c7 !important;
        	border: 1px solid #dcdcdc !important;
        }
        .aui-btn-primary.aui-btn-outlined {
        	color: #00bcd4 !important;
        	border: 1px solid #00bcd4 !important;
        }
        .aui-btn-success.aui-btn-outlined {
        	color: #009688 !important;
        	border: 1px solid #009688 !important;
        }
        .aui-btn-info.aui-btn-outlined {
        	color: #03a9f4 !important;
        	border: 1px solid #03a9f4 !important;
        }
        .aui-btn-warning.aui-btn-outlined {
        	color: #ffc107 !important;
        	border: 1px solid #ffc107 !important;
        }
        .aui-btn-danger.aui-btn-outlined {
        	color: #e51c23 !important;
        	border: 1px solid #e51c23 !important;
        }
        .title {
            color: #fff;
            font-size: 23px;
            padding: 10px 0px 10px 10px;
            background-color: grey;
            height: 30px;
        }

        .bt {
            position: relative;
            top: 1px;
            padding: 0px 0px 0px 30px;
            font-size: 20px;
        }

        .q2 {
            width: 80%;
            height: 60%;
            position: relative;
            bottom: 40px;
            left: 15%;
        }

        .yjff {
            background-color: #dbeeec;
            height: 460px;
            width: 90%;
            position: relative;
            left: 25px;
            top: 30px;
        }

        .yjff2 {
            background-color: lightgrey;
            height: 250px;
            width: 80%;
            position: relative;
            left: 50px;
            top: 80px;
        }

        .bs1 {
            position: relative;
            top: 15px;
            padding: 0px 0px 0px 30px;
            font-size: 22px;
        }

        .bs2 {
            position: relative;
            padding: 0px 0px 0px 30px;
            top: 60px;
            font-size: 20px;
        }
        .textarea{
            outline-style: none ;
            border: 1px solid #ccc;
            border-radius: 3px;
            padding: 15px 14px;
            width: 90%;
            padding-left: 20px;
            padding-top: 15px;
            font-size: 18px;
            font-weight: 700;
            line-height: normal;
        }
        section{
            width: 90%;
            height: 60px;
            padding-left: 24px;
            padding-top: 24px;
            font-size: 30px;
        }

    </style>
</head>

<body>
    <header id="kt" style="top: 23px">
        <div class="title" style="top: 23px">
            <p class="bt">患者资料</p>
        </div>
        <a id="back" class="fanhui">
            <img id="img2" class="q2" src="../image/abc_ic_ab_back_holo_dark.png">
        </a>
    </header>
    <div class="bs1">患者病史：</div>
    <div class="yjff">
        <textarea cols="10" rows="5" class="textarea" id="textView1"></textarea>
        <textarea cols="10" rows="14" class="textarea" id="textView2" style="top: 120px"></textarea>
    </div>
    <section class="aui-content-padded" id="submit">
        <div class="aui-btn aui-btn-block aui-btn-info aui-btn-sm" tapmode>保存病史</div>
    </section>

</body>

<script type="text/javascript" src="../script/url.js"></script>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript">
    var pId;
    $("#back").click(function() {
        api.closeWin({
            name: 'history'
        });
    })

    $("#submit").click(function () {
        saveHistory();
        alert("修改成功！");
        window.reload;

    })

    apiready = function () {
        getPatientInfo();
    }

    function saveHistory() {
        var pHistory1 = document.getElementById('textView1').value;
        var pHistory2 = document.getElementById('textView2').value;
        api.ajax({
            url: wurl + 'saveHistory',
            method: 'post',
            data: {
                values: {
                    'pHistory1': pHistory1,
                    'pHistory2': pHistory2
                },
            }
        },function(ret, err){
            if (ret) {
                getPatientInfo();
            } else {
                alert( JSON.stringify( err ) );
            }
        });

    }

    function getPatientInfo() {
        api.ajax({
            url: wurl + 'getPatient',
            method: 'Get',
            dataType: 'json'
        }, function(ret, err) {
            if (ret) {
                pId = ret.id;
                // alert(JSON.stringify(ret));
                if(typeof(ret.pHistory1) === 'undefined'){
                    $("#textView1").text("主诉：" + "");
                }else {
                    $("#textView1").text( ret.pHistory1);
                }

                if(typeof(ret.pHistory1) === 'undefined'){
                    $("#textView2").text("现病史：" + "");
                }else {
                    $("#textView2").text( ret.pHistory2);
                }
            } else {
                alert(JSON.stringify(err));
            }
        });
    }
</script>

</html>
